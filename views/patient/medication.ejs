<%- include('../partials/header', { title: 'Medication', stylesheetName: 'styles', headerTitle: 'Medication' }) %>
<%- include('../partials/patientNav') %>

<div class="medication-container">
  <div class="top-strip"></div>
  <div class="tabs">
    <div
      class="tab <%= activeTab === 'current' ? 'active' : '' %>"
      onclick="location.href='/medication?tab=current'"  
    >
      current
    </div>
    <div
      class="tab <%= activeTab === 'took_before' ? 'active' : '' %>"
      onclick="location.href='/medication?tab=took_before'"  
    >
      took before
    </div>
  </div>

  <div class="content-body">
    <% if (activeTab === 'current') { %>
    <div class="table-wrapper">
      <table>
        <% if (currentMedications && currentMedications.length > 0) { %>
        <thead>
          <tr>
            <th>date prescribed</th>
            <th>medication name</th>
            <th>refill times left (count)</th>
            <th>upcoming refill</th>
          </tr>
        </thead>
        <tbody>
          <% currentMedications.forEach(function(med) { %>
            <tr>
              <td><%= med.Date_Prescribed ? new Date(med.Date_Prescribed).toLocaleDateString() : 'N/A' %></td>
              <td><%= med.Medication_Name %></td>
              <td><%= med.Refill_Times ? med.Refill_Times : 'N/A' %> times</td>
              <td>
                <%= med.Upcoming_Refill ? new Date(med.Upcoming_Refill).toLocaleDateString() : 'N/A' %>
              </td>
            </tr>
          <% }); %>
        </tbody>
        <% } else { %>
        <thead>
          <tr>
            <th colspan="4">No current medications found.</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
        <% } %>
      </table>
    </div>
    <% } else if (activeTab === 'took_before') { %>
    <div class="table-wrapper">
      <table>
        <% if (pastMedications && pastMedications.length > 0) { %>
        <thead>
          <tr>
            <th>date prescribed</th>
            <th>medication name</th>
            <th>duration took for</th>
          </tr>
        </thead>
        <tbody>
          <% pastMedications.forEach(function(med) { %>
            <tr>
              <td><%= med.Date_Prescribed ? new Date(med.Date_Prescribed).toLocaleDateString() : 'N/A' %></td>
              <td><%= med.Medication_Name %></td>
              <td><%= med.Duration_Took_For ? med.Duration_Took_For : 'N/A' %> days</td>
            </tr>
          <% }); %>
        </tbody>
        <% } else { %>
        <thead>
          <tr>
            <th colspan="3">No previous medications found.</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
        <% } %>
      </table>
    </div>
    <% } %>
  </div>
</div>

<script src="js/main.js"></script>
<%- include('../partials/footer') %>
